{
  "componentCodeLanguage": "JavaScript",
  "componentCodeLanguageOther": "",
  "componentCode": "/*\r\n  Modal Dialog Component\r\n  ----------------------\r\n   Shows content in an accessible modal dialog\r\n\r\n   Instantiate\r\n   -----------\r\n   var dialog = new ModalDialog(element).init(options)\r\n\r\n   Options\r\n   -------\r\n   An object which can contain the following keys:\r\n   triggerElement: node which will have a click event listener added to trigger opening of the modal\r\n   focusElement: element that should gain focus when the dialog opens (defaults to the dialog itself)\r\n   onOpen: a callback function which will be invoked when the modal is opened\r\n   onClose: a callback function which will be invoked when the modal is closed\r\n   onDialogNotSupported: a callback function that will be invoked if there is no native <dialog> or dialog polyfill support\r\n\r\n*/\r\n\r\nimport { nodeListForEach } from 'govuk-frontend/govuk/common.js'\r\n\r\nfunction ModalDialog ($module) {\r\n  this.$module = $module\r\n  this.$dialogBox = $module.querySelector('dialog')\r\n  this.$container = document.documentElement\r\n\r\n  // Allowed focussable elements\r\n  this.focussable = [\r\n    'button',\r\n    '[href]',\r\n    'input',\r\n    'select',\r\n    'textarea'\r\n  ]\r\n\r\n  this.open = this.handleOpen.bind(this)\r\n  this.close = this.handleClose.bind(this)\r\n  this.focus = this.handleFocus.bind(this)\r\n  this.focusTrap = this.handleFocusTrap.bind(this)\r\n  this.boundKeyDown = this.handleKeyDown.bind(this)\r\n\r\n  // Modal elements\r\n  this.$closeButtons = this.$dialogBox.querySelectorAll('[data-element=\"govuk-modal-dialogue-close\"]')\r\n  this.$focussable = this.$dialogBox.querySelectorAll(this.focussable.toString())\r\n  this.$focusableLast = this.$focussable[this.$focussable.length - 1]\r\n  this.$inertContainer = document.querySelector( this.$module.dataset.inertContainer || '.govuk-modal-dialogue-inert-container' )\r\n}\r\n\r\n// Initialize component\r\nModalDialog.prototype.init = function (options) {\r\n// Check for module\r\n  if (!this.$module) {\r\n    return\r\n  }\r\n\r\n  this.options = options || {}\r\n\r\n  this.$focusElement = this.options.focusElement || this.$dialogBox\r\n\r\n  // Check for native dialog (or polyfill) support\r\n  // if no support trigger a callback allowing us to show a fallback\r\n  if (!this.dialogSupported()) {\r\n    if (typeof this.options.onDialogNotSupported === 'function') {\r\n      this.options.onDialogNotSupported.call()\r\n    }\r\n    return\r\n  }\r\n\r\n  if (this.$dialogBox.hasAttribute('open')) {\r\n    this.open()\r\n  }\r\n\r\n  this.initEvents()\r\n\r\n  return this\r\n}\r\n\r\nModalDialog.prototype.dialogSupported = function () {\r\n  if (typeof HTMLDialogElement === 'function') {\r\n    // Native dialog is supported by browser\r\n    return true\r\n  } else {\r\n    // Native dialog is not supported by browser so use polyfill\r\n    try {\r\n      window.dialogPolyfill.registerDialog(this.$dialog)\r\n      return true\r\n    } catch (error) {\r\n      // Doesn't support polyfill (IE8)\r\n      return false\r\n    }\r\n  }\r\n}\r\n// Initialize component events\r\nModalDialog.prototype.initEvents = function (options) {\r\n  if (this.options.triggerElement) {\r\n    this.options.triggerElement.addEventListener('click', this.open)\r\n  }\r\n\r\n  // Close dialogue on close button click\r\n  this.$closeButtons.forEach( function(element) {\r\n    element.addEventListener('click', this.close.bind(this));\r\n  }.bind(this));\r\n}\r\n\r\n// Open modal\r\nModalDialog.prototype.handleOpen = function (event) {\r\n  if (event) {\r\n    event.preventDefault()\r\n  }\r\n\r\n  // Save last-focussed element\r\n  this.$lastActiveElement = document.activeElement\r\n\r\n  // Disable scrolling, show wrapper\r\n  this.$container.classList.add('govuk-!-scroll-disabled')\r\n  this.$module.classList.add('govuk-modal-dialogue--open')\r\n\r\n  //make the content of the page inert\r\n  this.$inertContainer.inert = true\r\n  // hide content from screen readers in browsers that do not support inert\r\n  this.$inertContainer.setAttribute('aria-hidden', 'true')\r\n\r\n  // Close on escape key, trap focus\r\n  document.addEventListener('keydown', this.boundKeyDown, true)\r\n\r\n  // Optional 'onOpen' callback\r\n  if (typeof this.options.onOpen === 'function') {\r\n    this.options.onOpen.call(this)\r\n  }\r\n\r\n  // Skip open if already open\r\n  if (this.$dialogBox.hasAttribute('open')) {\r\n    return\r\n  }\r\n\r\n  // Show modal\r\n  this.$dialogBox.setAttribute('open', '')\r\n\r\n  // Handle focus\r\n  this.focus()\r\n}\r\n\r\n// Close modal\r\nModalDialog.prototype.handleClose = function (event) {\r\n  if (event) {\r\n    event.preventDefault()\r\n  }\r\n\r\n  // Skip close if already closed\r\n  if (!this.$dialogBox.hasAttribute('open')) {\r\n    return\r\n  }\r\n\r\n  // Hide modal\r\n  this.$dialogBox.removeAttribute('open')\r\n\r\n  // Hide wrapper, enable scrolling\r\n  this.$module.classList.remove('govuk-modal-dialogue--open')\r\n  this.$container.classList.remove('govuk-!-scroll-disabled')\r\n  // make content active again, and un-hide from AT\r\n  this.$inertContainer.inert = false\r\n  this.$inertContainer.setAttribute('aria-hidden', 'false')\r\n\r\n  // Restore focus to last active element\r\n  this.$lastActiveElement.focus()\r\n\r\n  // Optional 'onClose' callback\r\n  if (typeof this.options.onClose === 'function') {\r\n    this.options.onClose.call(this)\r\n  }\r\n\r\n  // Remove escape key and trap focus listener\r\n  document.removeEventListener('keydown', this.boundKeyDown, true)\r\n}\r\n\r\nModalDialog.prototype.isOpen = function() {\r\n  return this.$dialogBox.hasAttribute('open');\r\n}\r\n\r\n// Lock scroll, focus modal\r\nModalDialog.prototype.handleFocus = function () {\r\n  this.$dialogBox.scrollIntoView()\r\n  this.$focusElement.focus({ preventScroll: true })\r\n}\r\n\r\n// Ensure focus stays within modal\r\nModalDialog.prototype.handleFocusTrap = function (event) {\r\n  var $focusElement\r\n\r\n  // Check for tabbing outside dialog\r\n  var hasFocusEscaped = document.activeElement !== this.$dialogBox\r\n\r\n  // Loop inner focussable elements\r\n  if (hasFocusEscaped) {\r\n    this.$focussable.forEach( function (element) {\r\n      // Actually, focus is on an inner focussable element\r\n      if (hasFocusEscaped && document.activeElement === element) {\r\n        hasFocusEscaped = false\r\n      }\r\n    })\r\n\r\n    // Wrap focus back to first element\r\n    $focusElement = hasFocusEscaped\r\n      ? this.$dialogBox\r\n      : undefined\r\n  }\r\n\r\n  // Wrap focus back to first/last element\r\n  if (!$focusElement) {\r\n    if ((document.activeElement === this.$focusableLast && !event.shiftKey) || !this.$focussable.length) {\r\n      $focusElement = this.$dialogBox\r\n    } else if (document.activeElement === this.$dialogBox && event.shiftKey) {\r\n      $focusElement = this.$focusableLast\r\n    }\r\n  }\r\n\r\n  // Wrap focus\r\n  if ($focusElement) {\r\n    event.preventDefault()\r\n    $focusElement.focus({ preventScroll: true })\r\n  }\r\n}\r\n\r\n// Listen for key presses\r\nModalDialog.prototype.handleKeyDown = function (event) {\r\n  var KEY_TAB = 9\r\n  var KEY_ESCAPE = 27\r\n\r\n  switch (event.keyCode) {\r\n    case KEY_TAB:\r\n      this.focusTrap(event)\r\n      break\r\n\r\n    case KEY_ESCAPE:\r\n      this.close()\r\n      break\r\n  }\r\n}\r\n\r\nexport default ModalDialog\r\n",
  "componentCodeUsage": "The code uses the native `dialog` element.  If older browser support is needed a polyfill can be used.\r\n"
}